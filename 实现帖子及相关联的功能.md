**帖子表的设计：**

​	由于发帖人是医生，也只有监护人会收到帖子。所以设计为如下的表结构：

![](G:\NotesOfAll\github仓库（考研心得）\images\屏幕截图 2024-11-16 191925.png)

​	content里面存储由前端发送来的html格式的医生编辑的数据（由markdown内容转换的html），在监护人端进行对html数据的渲染展示。

**监护人端获取帖子数据**

​	返回帖子的json（ArticleDao）数据

```json
{
    "postId": "1",
    "title": "老人的兴趣在何处", //帖子标题
    "content": "<h1>我也不知道</h1><p>嘻嘻</p>", //html数据
    "doctor": {
        "userName": "刘医生",
        "address": "xxx市xxx医院",
        "phoneNumber": "132xxxxxx"
    }, //关于医生作者的信息
    "likes": "2",  //喜欢数
    "collections": "2", //收藏数
    "comments": "10", //评论数
    "createTime": "2024-9-19-14:34:43" //帖子创建时间
}
```

​	注意这里没有返回评论的数据，因为用户可能不会点击进入帖子，在进入后才进行返回评论的数据。使用mybatisplus的分页插件进行分页返回。

​	请求体中传入的json数据为：

```json
{
    "pageNum": "1", //请求的页数
    "pageSize": "5" //返回的数据条数 
}
```

​	返回的数据封装为IPage<ArticleDao>，这个会根据pageSize的值封装为List对象返回，并且这个包含数据总条数、现在的页数、总页数等信息，很方便

**点赞功能**

​	因为点赞和收藏的行为时时刻刻都在发生，所以肯定不能直接操作数据库。所以使用redis和定时任务定时的刷数据。在项目启动时加载一部分帖子信息到redis中，然后在更新时查询redis中是否存在，若没有的话怎从数据库中加载（懒加载模式）。

**热门帖子的实现**

​	可以通过加载最近几天的帖子到redis中然后根据某个算法计算得出post的score，根据score进行排行则可

 **推送功能**

​	项目启动时从数据库中根据点赞数和评论数的权重进行排序预热100份帖子到redis中，先从redis中获取然后

用户再从数据库中获取数据。

​	还可以实现随机推送。这样实现就需要实现推送过的帖子不再推送，可以使用redis实现。key保存用户的唯一

标识，value保存List<post_id>就可以实现在一定时间内不再对该用户推送推送过的帖子

​	更加成熟的方案是设计一个关于用户收藏和点赞甚至帖子浏览时间的表，每次用户获取推送时，根据这个表

的数据分析该用户的喜好，根据喜好推送。

**评论功能**

​	表的设计：

​	

​	

